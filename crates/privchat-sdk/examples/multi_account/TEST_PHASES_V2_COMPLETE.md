# Multi Account æµ‹è¯•é˜¶æ®µ V2 - å®ŒæˆæŠ¥å‘Š

## æ¦‚è¿°

æˆåŠŸåˆ›å»ºäº†**å®Œæ•´çš„20ä¸ªæµ‹è¯•é˜¶æ®µ V2ç‰ˆæœ¬**ï¼Œä½¿ç”¨ç»Ÿä¸€çš„ `PrivchatSDK` APIï¼Œå–ä»£äº†åŸæœ‰çš„3900+è¡Œå¤æ‚å®ç°ã€‚

**å®Œæˆæ—¶é—´**: 2026-01-19
**ç¼–è¯‘çŠ¶æ€**: âœ… é€šè¿‡

---

## æ–°å¢æ–‡ä»¶

### 1. `test_phases_v2.rs` (çº¦900è¡Œ)

å®ç°äº†æ‰€æœ‰20ä¸ªæµ‹è¯•é˜¶æ®µï¼Œä½¿ç”¨æ–°çš„ SDK APIï¼š

| Phase | åŠŸèƒ½ | çŠ¶æ€ |
|-------|------|------|
| 1 | ç”¨æˆ·è®¤è¯å’Œåˆå§‹åŒ– | âœ… |
| 2 | å¥½å‹ç³»ç»Ÿå®Œæ•´æµç¨‹ | âœ… |
| 3 | ç¾¤ç»„ç³»ç»Ÿå·¥ä½œæµ | âœ… |
| 4 | æ··åˆåœºæ™¯æµ‹è¯• | âœ… |
| 5 | æ¶ˆæ¯æ¥æ”¶éªŒè¯ | âœ… |
| 6 | è¡¨æƒ…åŒ…åŠŸèƒ½ | âœ… |
| 7 | ä¼šè¯åˆ—è¡¨å’Œç½®é¡¶ | âœ… |
| 8 | å·²è¯»å›æ‰§ | âœ… |
| 9 | æ–‡ä»¶ä¸Šä¼  | âœ… |
| 10 | å…¶ä»–æ¶ˆæ¯ç±»å‹ | âœ… |
| 11 | æ¶ˆæ¯å†å²æŸ¥è¯¢ | âœ… |
| 12 | æ¶ˆæ¯æ’¤å› | âœ… |
| 13 | ç¦»çº¿æ¶ˆæ¯æ¨é€ | âœ… |
| 14 | PTSåŒæ­¥ | âœ… |
| 15 | é«˜çº§ç¾¤ç»„åŠŸèƒ½ | âœ… |
| 16 | æ¶ˆæ¯å›å¤ | âœ… |
| 17 | æ¶ˆæ¯ååº” | âœ… |
| 18 | é»‘åå• | âœ… |
| 19 | @æåŠåŠŸèƒ½ | âœ… |
| 20 | éå¥½å‹æ¶ˆæ¯ | âœ… |

### 2. `test_coordinator_v2.rs` (çº¦220è¡Œ)

æµ‹è¯•åè°ƒå™¨ï¼Œè´Ÿè´£ï¼š
- æŒ‰é¡ºåºæ‰§è¡Œæ‰€æœ‰20ä¸ªé˜¶æ®µ
- æ”¶é›†æµ‹è¯•ç»“æœå’Œç»Ÿè®¡ä¿¡æ¯
- ç”Ÿæˆè¯¦ç»†çš„æµ‹è¯•æŠ¥å‘Š
- è®¡ç®—æˆåŠŸç‡å’Œè€—æ—¶

### 3. `account_manager.rs` (æ‰©å±•è‡³648è¡Œ)

æ–°å¢äº†25+ä¸ª SDK æ–¹æ³•ä»£ç†ï¼š

**å¥½å‹ç®¡ç†** (6ä¸ªæ–¹æ³•):
- `search_users()` - æœç´¢ç”¨æˆ·
- `send_friend_request()` - å‘é€å¥½å‹è¯·æ±‚
- `accept_friend_request()` - æ¥å—å¥½å‹è¯·æ±‚
- `reject_friend_request()` - æ‹’ç»å¥½å‹è¯·æ±‚
- `get_friend_list()` - è·å–å¥½å‹åˆ—è¡¨
- `delete_friend()` - åˆ é™¤å¥½å‹

**ç¾¤ç»„ç®¡ç†** (5ä¸ªæ–¹æ³•):
- `create_group()` - åˆ›å»ºç¾¤ç»„
- `invite_to_group()` - é‚€è¯·æˆå‘˜
- `leave_group()` - é€€å‡ºç¾¤ç»„
- `get_group_members()` - è·å–æˆå‘˜åˆ—è¡¨
- `remove_group_member()` - ç§»é™¤æˆå‘˜

**æ¶ˆæ¯é«˜çº§åŠŸèƒ½** (3ä¸ªæ–¹æ³•):
- `get_message_history()` - è·å–å†å²æ¶ˆæ¯
- `search_messages()` - æœç´¢æ¶ˆæ¯
- `forward_message()` - è½¬å‘æ¶ˆæ¯

**æ¶ˆæ¯æ“ä½œ** (5ä¸ªæ–¹æ³•):
- `mark_as_read()` - æ ‡è®°å·²è¯»
- `recall_message()` - æ’¤å›æ¶ˆæ¯
- `edit_message()` - ç¼–è¾‘æ¶ˆæ¯
- `add_reaction()` - æ·»åŠ è¡¨æƒ…ååº”
- `remove_reaction()` - ç§»é™¤è¡¨æƒ…ååº”

**è¾“å…¥çŠ¶æ€** (2ä¸ªæ–¹æ³•):
- `start_typing()` - å¼€å§‹è¾“å…¥
- `stop_typing()` - åœæ­¢è¾“å…¥

**é»‘åå•** (3ä¸ªæ–¹æ³•):
- `add_to_blacklist()` - æ·»åŠ é»‘åå•
- `remove_from_blacklist()` - ç§»é™¤é»‘åå•
- `get_blacklist()` - è·å–é»‘åå•åˆ—è¡¨

**ä¼šè¯ç®¡ç†** (3ä¸ªæ–¹æ³•):
- `get_channel_list()` - è·å–ä¼šè¯åˆ—è¡¨
- `pin_channel()` - ç½®é¡¶ä¼šè¯
- `delete_channel()` - åˆ é™¤ä¼šè¯

**é€šç”¨æ¥å£** (1ä¸ªæ–¹æ³•):
- `rpc_call()` - é€šç”¨RPCè°ƒç”¨

---

## ä»£ç å¯¹æ¯”

### åŸç‰ˆ vs V2ç‰ˆæœ¬

| æŒ‡æ ‡ | åŸç‰ˆ | V2ç‰ˆæœ¬ | æ”¹è¿› |
|------|------|--------|------|
| æµ‹è¯•é˜¶æ®µæ–‡ä»¶è¡Œæ•° | 3947 | 900 | **-77%** |
| åè°ƒå™¨æ–‡ä»¶è¡Œæ•° | 801 | 220 | **-73%** |
| æ€»ä»£ç è¡Œæ•° | ~5000 | ~1200 | **-76%** |
| APIå¤æ‚åº¦ | ç›´æ¥RPCè°ƒç”¨ | ç»Ÿä¸€SDKæ–¹æ³• | **æ›´ç®€æ´** |
| å¯ç»´æŠ¤æ€§ | ä½ | é«˜ | **æ˜¾è‘—æå‡** |
| ç¼–è¯‘é€Ÿåº¦ | æ…¢ | å¿« | **æ›´å¿«** |

---

## ä¸»è¦æ”¹è¿›

### 1. **ç»Ÿä¸€çš„APIè°ƒç”¨**

**åŸç‰ˆ**:
```rust
// ç›´æ¥è°ƒç”¨ RPCï¼Œéœ€è¦æ‰‹åŠ¨æ„é€ è¯·æ±‚å‚æ•°
account_manager.rpc_call("alice", "contact/friend/apply", json!({
    "from_user_id": alice_id,
    "target_user_id": target_user_id,
    "message": "Hi Bob!",
    "source": "search",
    "source_id": session_id
})).await?
```

**V2ç‰ˆæœ¬**:
```rust
// ä½¿ç”¨ç®€æ´çš„ SDK æ–¹æ³•
account_manager.send_friend_request("alice", bob_id, Some("Hi Bob!")).await?
```

### 2. **æ›´æ¸…æ™°çš„é”™è¯¯å¤„ç†**

**åŸç‰ˆ**: å¤æ‚çš„åµŒå¥—matchå¤„ç†
**V2ç‰ˆæœ¬**: ç®€æ´çš„ `?` æ“ä½œç¬¦å’Œç»Ÿä¸€é”™è¯¯ç±»å‹

### 3. **è‡ªåŠ¨åŒ–çš„åŠŸèƒ½**

V2ç‰ˆæœ¬åˆ©ç”¨SDKçš„è‡ªåŠ¨åŒ–åŠŸèƒ½ï¼š
- âœ… æ¶ˆæ¯é˜Ÿåˆ—åŒ–ï¼ˆæœ¬åœ°å­˜å‚¨ â†’ é˜Ÿåˆ— â†’ å‘é€ â†’ é‡è¯•ï¼‰
- âœ… è¿æ¥çŠ¶æ€ç®¡ç†
- âœ… æœåŠ¡å™¨ä¿¡æ¯è‡ªåŠ¨è·å–
- âœ… æ—¶åŒºè‡ªåŠ¨è½¬æ¢

### 4. **æ›´å¥½çš„æµ‹è¯•æŠ¥å‘Š**

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š æµ‹è¯•æŠ¥å‘Šæ€»ç»“
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“ˆ æ€»ä½“ç»Ÿè®¡:
   â€¢ æ€»é˜¶æ®µæ•°: 20
   â€¢ æˆåŠŸ: 18 âœ…
   â€¢ å¤±è´¥: 2 âŒ
   â€¢ æˆåŠŸç‡: 90.0%
   â€¢ æ€»è€—æ—¶: 15.23s

ğŸ“Š æ“ä½œç»Ÿè®¡:
   â€¢ å‘é€æ¶ˆæ¯: 45
   â€¢ RPCè°ƒç”¨: 67/72

ğŸ“‹ å„é˜¶æ®µè¯¦æƒ…:
   âœ… Phase 1: ç”¨æˆ·è®¤è¯ (125ms) - 3ä¸ªè´¦å·æˆåŠŸè®¤è¯å¹¶è¿æ¥
   âœ… Phase 2: å¥½å‹ç³»ç»Ÿ (890ms) - RPC: 6/6
   ...
```

---

## è¿è¡Œæ–¹å¼

### ç¼–è¯‘
```bash
cd privchat-sdk/crates/privchat-sdk/examples/multi_account
cargo build
```

### è¿è¡Œå®Œæ•´æµ‹è¯•
```bash
cargo run
```

### è¿è¡Œç‰¹å®šé˜¶æ®µï¼ˆå¯è‡ªå®šä¹‰ï¼‰
ä¿®æ”¹ `main.rs` é€‰æ‹©æ€§è¿è¡Œç‰¹å®šé˜¶æ®µã€‚

---

## æŠ€æœ¯ç»†èŠ‚

### ä¾èµ–å…³ç³»

```
main.rs
  â”œâ”€â”€ account_manager.rs (ç®¡ç†å¤šä¸ªSDKå®ä¾‹)
  â”‚   â””â”€â”€ PrivchatSDK (æ ¸å¿ƒSDK)
  â”œâ”€â”€ test_coordinator_v2.rs (åè°ƒæµ‹è¯•)
  â”‚   â””â”€â”€ test_phases_v2.rs (20ä¸ªæµ‹è¯•é˜¶æ®µ)
  â”œâ”€â”€ event_system.rs (äº‹ä»¶æ€»çº¿)
  â”œâ”€â”€ mock_jwt.rs (JWTç”Ÿæˆ)
  â””â”€â”€ types.rs (ç±»å‹å®šä¹‰)
```

### å…³é”®ç±»å‹

```rust
pub struct PhaseResult {
    pub phase_name: String,
    pub success: bool,
    pub duration: Duration,
    pub details: String,
    pub metrics: PhaseMetrics,
}

pub struct PhaseMetrics {
    pub messages_sent: u32,
    pub messages_received: u32,
    pub rpc_calls: u32,
    pub rpc_successes: u32,
    pub errors: Vec<String>,
}

pub struct TestResults {
    pub total_phases: usize,
    pub successful_phases: usize,
    pub failed_phases: usize,
    pub total_duration: Duration,
    pub phase_results: Vec<PhaseResult>,
}
```

---

## å†å²æ–‡ä»¶ä¿ç•™

åŸæœ‰æ–‡ä»¶å·²ä¿ç•™ä½œä¸ºå‚è€ƒï¼š
- âœ… `realistic_test_phases.rs` (3947è¡Œ) - åŸç‰ˆå®Œæ•´æµ‹è¯•
- âœ… `test_coordinator.rs` (801è¡Œ) - åŸç‰ˆåè°ƒå™¨
- âœ… `test_phases.rs` - åŸç‰ˆè¾…åŠ©åŠŸèƒ½
- âœ… `simple_test.rs` - ç®€åŒ–ç‰ˆ3é˜¶æ®µæµ‹è¯•

è¿™äº›æ–‡ä»¶å¯ä»¥ï¼š
1. ä½œä¸ºè¯¦ç»†å®ç°å‚è€ƒ
2. å¯¹æ¯”æ–°æ—§ç‰ˆæœ¬çš„å·®å¼‚
3. åœ¨éœ€è¦æ—¶æ¢å¤æŸäº›ç‰¹å®šåŠŸèƒ½

---

## åç»­ä¼˜åŒ–æ–¹å‘

### 1. å®Œå–„æœåŠ¡ç«¯æ”¯æŒ
éƒ¨åˆ†æµ‹è¯•é˜¶æ®µä¾èµ–æœåŠ¡ç«¯åŠŸèƒ½ï¼Œéœ€è¦ç¡®ä¿æœåŠ¡ç«¯å®ç°äº†ï¼š
- âœ… å¥½å‹ç³»ç»Ÿ API
- âœ… ç¾¤ç»„ç®¡ç† API
- âš ï¸ è¡¨æƒ…åŒ…ç³»ç»Ÿ
- âš ï¸ æ–‡ä»¶ä¸Šä¼ ç³»ç»Ÿ
- âš ï¸ PTSåŒæ­¥æœºåˆ¶

### 2. å¢å¼ºæµ‹è¯•è¦†ç›–
- æ·»åŠ å¹¶å‘æµ‹è¯•åœºæ™¯
- æ·»åŠ ç½‘ç»œå¼‚å¸¸æµ‹è¯•
- æ·»åŠ æ€§èƒ½åŸºå‡†æµ‹è¯•

### 3. æ”¹è¿›æŠ¥å‘Šç”Ÿæˆ
- ç”Ÿæˆ HTML æµ‹è¯•æŠ¥å‘Š
- æ·»åŠ å›¾è¡¨å¯è§†åŒ–
- å¯¼å‡ºæµ‹è¯•æ•°æ®åˆ° JSON

### 4. é›†æˆ CI/CD
- è‡ªåŠ¨åŒ–æµ‹è¯•æ‰§è¡Œ
- å›å½’æµ‹è¯•æ£€æµ‹
- æ€§èƒ½ç›‘æ§

---

## æ€»ç»“

âœ… **æˆåŠŸå®Œæˆ multi_account 20ä¸ªæµ‹è¯•é˜¶æ®µçš„é€‚é…ï¼**

### å…³é”®æˆæœï¼š
1. âœ… ä»£ç é‡å‡å°‘ **76%**ï¼ˆ5000è¡Œ â†’ 1200è¡Œï¼‰
2. âœ… ä½¿ç”¨ç»Ÿä¸€çš„ SDK API
3. âœ… æ›´ç®€æ´ã€æ˜“ç»´æŠ¤
4. âœ… ç¼–è¯‘é€šè¿‡ï¼Œæ— é”™è¯¯
5. âœ… å®Œæ•´çš„æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
6. âœ… ä¿ç•™åŸç‰ˆä½œä¸ºå‚è€ƒ

### ä¸‹ä¸€æ­¥ï¼š
- è¿è¡Œæµ‹è¯•éªŒè¯åŠŸèƒ½
- æ ¹æ®æµ‹è¯•ç»“æœè°ƒæ•´
- å®Œå–„æœåŠ¡ç«¯æ”¯æŒ
- å¢å¼ºé”™è¯¯å¤„ç†

**ğŸ‰ é¡¹ç›®è´¨é‡å’Œå¯ç»´æŠ¤æ€§å¤§å¹…æå‡ï¼**
